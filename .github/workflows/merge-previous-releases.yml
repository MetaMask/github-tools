name: Merge Previous Releases

on:
  workflow_call:
    inputs:
      new-release-branch:
        required: true
        type: string
        description: 'The newly created release branch (e.g., release/2.1.2)'
    secrets:
      github-token:
        required: true
        description: 'GitHub token for authentication'

  workflow_dispatch:
    inputs:
      new-release-branch:
        required: true
        type: string
        description: 'The newly created release branch (e.g., release/2.1.2)'

jobs:
  merge-previous-releases:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v5
        with:
          ref: ${{ inputs.new-release-branch }}
          fetch-depth: 0

      - name: Checkout GitHub tools repository
        uses: actions/checkout@v5
        with:
          repository: metamask/github-tools
          path: ./github-tools

      - name: Set Git user and email
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: Run merge previous releases script
        env:
          NEW_RELEASE_BRANCH: ${{ inputs.new-release-branch }}
          GITHUB_TOKEN: ${{ secrets.github-token || secrets.GITHUB_TOKEN }}
        run: bash ./github-tools/.github/scripts/merge-previous-releases.sh
